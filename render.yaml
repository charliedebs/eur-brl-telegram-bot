services:
  - type: web
    name: eur-brl-telegram-bot
    runtime: node
    # IMPORTANT: Root directory doit Ãªtre la racine du projet, pas src/
    rootDir: .
    # Build command with Chromium installation for WhatsApp
    buildCommand: |
      # Install Chromium dependencies for WhatsApp Web
      apt-get update
      apt-get install -y chromium-browser chromium-codecs-ffmpeg
      # Install Node dependencies
      PUPPETEER_SKIP_DOWNLOAD=false npm install
    startCommand: npm start
    # Disk for WhatsApp session persistence
    disk:
      name: whatsapp-session
      mountPath: /opt/render/project/.wwebjs_auth
      sizeGB: 1
    envVars:
      - key: NODE_ENV
        value: production
      - key: TELEGRAM_BOT_TOKEN
        sync: false
      - key: TELEGRAM_WEBHOOK_DOMAIN
        sync: false
      - key: WISE_API_TOKEN
        sync: false
      - key: COINGECKO_API_KEY
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_KEY
        sync: false
      # WhatsApp configuration
      - key: WHATSAPP_ENABLED
        value: false
      # Puppeteer configuration for WhatsApp
      - key: PUPPETEER_SKIP_DOWNLOAD
        value: false
      - key: PUPPETEER_EXECUTABLE_PATH
        value: /usr/bin/chromium-browser
      # Admin password for QR code access
      - key: ADMIN_PASSWORD
        sync: false
